#!/bin/bash

NUM_GENERATORS=5
NUM_PARTITION_PERSON=20
NUM_PARTITION_AUCTIONS=20
NUM_WORKERS_PERSONS=2
NUM_WORKERS_AUCTIONS=2
SIZE_PERSONS=380000000
SIZE_AUCTIONS=7000000000
DESIRED_PERSONS=8192
DESIRED_AUCTIONS=16384
SOURCE_PARALLELISM=50
WINDOW_SIZE=43200
WORKER_PARALLELISM=80
#WORKER_PARALLELISM=105
WINDOW_SLIDE=60
#WINDOW_SIZE=86400
#WINDOW_SIZE=800
WINDOW_TYPE=0
REPLICA_SLOTS=2
CHECKPOINT_INTERVAL=300000
MAX_PARALLELISM=32768
#CHECKPOINT_INTERVAL=300000
VIRTUAL_NODES=4
PARALLEL_CHECKPOINT=1
KAFKA_SERVERS=`cat /tmp/brokers.txt`
$EXPERIMENT_DIR/scripts/start-dstat-all.sh

$EXPERIMENT_DIR/flink-build/bin/flink run $EXPERIMENT_JOBS_DIR/im-job-benchmarks_2.11-0.1-SNAPSHOT.jar -qx -bidsToGenerate $SIZE_BIDS -bidsRate $DESIRED_BIDS -latencyTrackingInterval 0 -numOfVirtualNodes $VIRTUAL_NODES -sourceParallelism $SOURCE_PARALLELISM -windowType $WINDOW_TYPE -windowSlide $WINDOW_SLIDE -maxParallelism $MAX_PARALLELISM -kafkaServers $KAFKA_SERVERS  -numOfReplicaSlotsHint $REPLICA_SLOTS -windowParallelism $WORKER_PARALLELISM -concurrentCheckpoints $PARALLEL_CHECKPOINT -sinkParallelism $WORKER_PARALLELISM -checkpointingInterval $CHECKPOINT_INTERVAL -personStreamSizeGb $SIZE_PERSONS -auctionStreamSizeGb $SIZE_AUCTIONS -checkpointingTimeout 50000000 -windowDuration $WINDOW_SIZE -autogen true -personToGenerate $SIZE_PERSONS -auctionsToGenerate $SIZE_AUCTIONS -personRate $DESIRED_PERSONS -auctionRate $DESIRED_AUCTIONS  > run-80.log 2>&1 & 




